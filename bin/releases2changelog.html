<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Github Releases to Changelog File - releases2changelog</title>

  <link rel="stylesheet" href="../assets/style.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>
  <meta name="groc-relative-root" content="../"/>
  <meta name="groc-document-path" content="bin/releases2changelog"/>
  
  <meta name="groc-repository-url" content="https://github.com/killercup/ghReleases2Changelog"/>
  
</head>
<body>
  <div id="file-area">
    <div id="meta">
      <code class="file-path">
      
        <a href="https://github.com/killercup/ghReleases2Changelog/blob/master/bin/releases2changelog">bin/releases2changelog</a>
      
      </code>
    </div>
    <div id="document">
    
      <div class="segment">
      
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><h1 id="github-releases-to-changelog-file"><a href="#github-releases-to-changelog-file" class="anchor"></a>Github Releases to Changelog File</h1></div>
        </div>
      
      
        <div class="code"><div class="wrapper"><span class="hljs-pi">'use strict'</span>;
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><h2 id="cli"><a href="#cli" class="anchor"></a>CLI</h2></div>
        </div>
      
      
        <div class="code"><div class="wrapper">var optimist = require(<span class="hljs-attribute">'optimist</span>')
  .<span class="hljs-typename">string</span>(<span class="hljs-attribute">'repo</span>')
  .describe(<span class="hljs-attribute">'repo</span>', <span class="hljs-string">"The github repository, e.g. 'killercup/grock'."</span>)

  .<span class="hljs-typename">string</span>(<span class="hljs-attribute">'out</span>')
  .describe(<span class="hljs-attribute">'out</span>', <span class="hljs-string">"The file to write to"</span>)
  .<span class="hljs-keyword">default</span>(<span class="hljs-attribute">'out</span>', <span class="hljs-string">"Changelog.md"</span>)

  .<span class="hljs-typename">boolean</span>(<span class="hljs-attribute">'help</span>')
  .describe(<span class="hljs-attribute">'help</span>', <span class="hljs-attribute">'Show</span> this message')
  .<span class="hljs-keyword">alias</span>(<span class="hljs-literal">'h'</span>, <span class="hljs-attribute">'help</span>')

  .<span class="hljs-typename">boolean</span>(<span class="hljs-attribute">'version</span>')
  .describe(<span class="hljs-attribute">'version</span>', <span class="hljs-attribute">'Show</span> version')
  .<span class="hljs-keyword">alias</span>(<span class="hljs-attribute">'V</span>', <span class="hljs-attribute">'version</span>')
;
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><h3 id="display-help"><a href="#display-help" class="anchor"></a>Display Help</h3></div>
        </div>
      
      
        <div class="code"><div class="wrapper">if (optimist<span class="hljs-preprocessor">.argv</span><span class="hljs-preprocessor">.help</span>) {
  optimist<span class="hljs-preprocessor">.showHelp</span>()<span class="hljs-comment">;</span>
  return process<span class="hljs-preprocessor">.exit</span>(<span class="hljs-number">2</span>)<span class="hljs-comment">;</span>
}
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><h3 id="display-version"><a href="#display-version" class="anchor"></a>Display Version</h3></div>
        </div>
      
      
        <div class="code"><div class="wrapper"><span class="hljs-keyword">if</span> (optimist.argv.version) {
  <span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
  <span class="hljs-keyword">var</span> pkg = <span class="hljs-built_in">JSON</span>.parse(fs.readFileSync(__dirname+<span class="hljs-string">"/../package.json"</span>));
  console.log(<span class="hljs-string">"Version"</span>, pkg.version);
  <span class="hljs-keyword">return</span> process.exit(<span class="hljs-number">0</span>);
}
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><h2 id="request"><a href="#request" class="anchor"></a>Request</h2></div>
        </div>
      
      
        <div class="code"><div class="wrapper">optimist.demand(<span class="hljs-string">'repo'</span>);

<span class="hljs-keyword">var</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">'request'</span>);
<span class="hljs-keyword">var</span> convert = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/convert'</span>);

<span class="hljs-keyword">var</span> options = {
  url: <span class="hljs-string">"https://api.github.com/repos/"</span>+optimist.argv.repo+<span class="hljs-string">"/releases"</span>,
  headers: {
    <span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'request'</span>
  }
};

request(options, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(error, response, body)</span> {</span>
  <span class="hljs-keyword">if</span> (error) { <span class="hljs-keyword">throw</span> error; }
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">var</span> json = <span class="hljs-built_in">JSON</span>.parse(body);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-keyword">throw</span> e;
    console.log(<span class="hljs-string">"body"</span>, body);
  }
  convert(json, optimist.argv.out)
  .on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
    console.log(<span class="hljs-string">"Error processing data."</span>, e);
  })
  .on(<span class="hljs-string">'finish'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    console.log(<span class="hljs-string">"Done. Wrote to"</span>, optimist.argv.out);
  });
});
</div></div>
      
      </div>
    
    </div>
  </div>

  <script src="../toc.js"></script>
  <script src="../assets/libs.js"></script>
  <script src="../assets/behavior.js"></script>
</body>
</html>